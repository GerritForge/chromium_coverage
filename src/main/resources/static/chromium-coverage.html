<!--
Copyright 2018 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<script src="./coverage.js"></script>

<dom-module id='chromium-coverage'>
  <script>
    (function() {
      'use strict';

      Gerrit.install(function(plugin) {
        const coverageClient = new window.CoverageClient();
        const annotationApi = plugin.annotationApi();
        annotationApi.setCoverageProvider(coverageClient.provideCoverageData);

        // provideCoverageData is only called when user expands diff view, and
        // to make sure coverage data can be fetched in time and shows up
        // reliably, prefetch the coverage data in advance.
        plugin.on('showchange', coverageClient.prefetchCoverageData);
      });
    })();
  </script>
</dom-module>
